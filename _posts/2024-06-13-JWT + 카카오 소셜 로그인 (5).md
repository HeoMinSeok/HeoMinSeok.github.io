---
title: "JWT + ì¹´ì¹´ì˜¤ ì†Œì…œ ë¡œê·¸ì¸ (5)"
date: 2024-06-13
categories: [í”„ë¡œì íŠ¸, PETSTAGRAM]
tags:
  - React
  - Spring Boot
  - JWT
  - Social Login
  - Kakao
  - OAuth2.0
---

# ğŸ“Œ Server Side

## 4. í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ ë°›ì€ ì¸ê°€ ì½”ë“œë¥¼ ì´ìš©í•˜ì—¬ ì¹´ì¹´ì˜¤ ì„œë²„ì— í† í° ìš”ì²­

- ë¨¼ì € í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì¸ê°€ ì½”ë“œë¥¼ ë°›ì•„ì˜¤ëŠ” ì—”ë“œí¬ì¸íŠ¸ì—ì„œ, ì¹´ì¹´ì˜¤ ì„œë²„ì— ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œ

```java
/* AuthController.java */
@GetMapping("/kakao")
public ResponseEntity<UserDTO> kakaoLogin(@RequestParam String code) {
  UserDTO userDTO = authService.kakaoLogin(code);
  return ResponseEntity.ok(userDTO);
}
```

```java
/* AuthService - kakaoLogin ë©”ì†Œë“œ */
public UserDTO kakaoLogin(String code) {
  KakaoTokenDto kakaoTokenDto = getKakaoAccessToken(code);
  String accessToken = kakaoTokenDto.getAccess_token();
  /* Â·Â·Â· */
}
```

- `getKakaoAccessToken` : ì¹´ì¹´ì˜¤ ì„œë²„ì— ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­ ë¶€ë¶„

<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```java
/* AuthService - getKakaoAccessToken ë©”ì†Œë“œ */
public KakaoTokenDto getKakaoAccessToken(String code) {
  HttpHeaders headers = new HttpHeaders();
  headers.add("Content-type", "application/x-www-form-urlencoded;charset=utf-8");

  MultiValueMap<String, String> params = new LinkedMultiValueMap<>();
  params.add("grant_type", "authorization_code");
  params.add("client_id", KAKAO_CLIENT_ID);
  params.add("redirect_uri", KAKAO_REDIRECT_URI);
  params.add("code", code);
  params.add("client_secret", KAKAO_CLIENT_SECRET);

  HttpEntity<MultiValueMap<String, String>> request = new HttpEntity<>(params, headers);
  RestTemplate restTemplate = new RestTemplate();

  ResponseEntity<String> response = restTemplate.exchange(
          "https://kauth.kakao.com/oauth/token",
          HttpMethod.POST,
          request,
          String.class
  );
/* Â·Â·Â· */
}
```

</div>
</details>

## 5. ì¹´ì¹´ì˜¤ ì„œë²„ì—ì„œ ë°±ì—”ë“œ ì„œë²„ë¡œ í† í° ë°œí–‰

- `getKakaoAccessToken` : ì¹´ì¹´ì˜¤ ì„œë²„ë¡œë¶€í„° ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ ë¶€ë¶„
<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```java
/* AuthService - getKakaoAccessToken ë©”ì†Œë“œ */
public KakaoTokenDto getKakaoAccessToken(String code) {
  /* Â·Â·Â· */
  ObjectMapper objectMapper = new ObjectMapper();
  objectMapper.registerModule(new JavaTimeModule());
  objectMapper.configure(DeserializationFeatureFAIL_ON_UNKNOWN_PROPERTIES, false);

  KakaoTokenDto kakaoTokenDto;
  try {
    kakaoTokenDto = objectMapper.readValue(response.getBody(), KakaoTokenDto.class);
  } catch (Exception e) {
    throw new RuntimeException("ì¹´ì¹´ì˜¤ í† í°ì„ ë°›ì•„ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }

  return kakaoTokenDto;
}
```

</div>
</details>

## 6.â—ï¸ í† í° ë°œê¸‰ì´ ì™„ë£Œë˜ë©´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ í›„ JWT í† í° ìƒì„±
<details>
<summary>ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```java
/* AuthService - kakaoLogin ë©”ì†Œë“œ */
public UserDTO kakaoLogin(String code) {
  KakaoTokenDto kakaoTokenDto = getKakaoAccessToken(code);
  String accessToken = kakaoTokenDto.getAccess_token();

  KakaoAccountDto kakaoUserInfoDto = getKakaoUserInfo(accessToken);
  /* Â·Â·Â· */
  UserEntity user = userRepository.findByEmail(email).orElseGet(() -> {
  /* Â·Â·Â· */
  });

  String jwt = jwtUtils.generateToken(user);
  String refreshToken = jwtUtils.generateRefreshToken(new HashMap<>(), user);

  UserDTO response = UserDTO.toDTO(user);
  response.setToken(jwt);
  response.setRefreshToken(refreshToken);

  return response;
}
```

</div>
</details>

> - ë°œê¸‰ë°›ì€ `accessToken`ì„ ì‚¬ìš©í•˜ì—¬ `getKakaoUserInfo` ë©”ì†Œë“œë¥¼ í†µí•´ ì¹´ì¹´ì˜¤ ì„œë²„ì˜ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒ
> - ì¡°íšŒí•œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ DBì— í•´ë‹¹ ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í›„ ì‚¬ìš©ì ì²˜ë¦¬
> - JWT í† í° ë° ë¦¬í”„ë ˆì‹œ í† í°ì„ ìƒì„±
> - UserDTO ê°ì²´ë¥¼ ìƒì„± ë° ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ê³ , í† í°ì„ ì„¤ì •í•˜ì—¬ ë°˜í™˜

## âœ”ï¸ ëìœ¼ë¡œ
- ë°˜í™˜í•œ JWT í† í°ì„ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ ë°›ì•„ì„œ ì‚¬ìš©ì ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ì™„ë£Œí•œë‹¤.
- ì´ ê³¼ì •ì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ì¸ì¦ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ë³´ë‹¤ ì•ˆì „í•˜ê³  í¸ë¦¬í•œ ë¡œê·¸ì¸ ê²½í—˜ì„ ì œê³µí•œë‹¤.
- ë˜í•œ, JWT í† í°ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì„œë²„ ê°„ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ì§€ ì•Šê³ ë„ ì¸ì¦ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ í™•ì¥ì„±ê³¼ ë³´ì•ˆì„±ì„ ë†’ì¼ ìˆ˜ ìˆì—ˆë‹¤.
